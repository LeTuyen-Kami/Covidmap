<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Show polygon information on click</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
    <link rel="stylesheet" href="style1.css" />
  </head>
  <body>
    <style>
      .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
      }
    </style>
    <div class="nav">
      <img
        src="https://cdn-icons-png.flaticon.com/512/3498/3498122.png"
        alt="Lotus"
      />
      <ul>
        <li><a href="#">home</a></li>
        <li><a href="/index1.html">map</a></li>
        <li><a href="#">News</a></li>
        <li><a href="/index.html">Chart</a></li>
        <div id="sliding"></div>
      </ul>
    </div>
    <div id="map"></div>
    <script>
      var sliding = document.getElementById("sliding");
      var item = document.querySelectorAll("a");
      function indicator(e) {
        sliding.style.left = e.offsetLeft + "px";
      }
      item.forEach((link) => {
        link.addEventListener("mouseover", (e) => {
          indicator(e.target);
        });
      });
      mapboxgl.accessToken =
        "pk.eyJ1Ijoia2FuZWtpcml0bzEyNzciLCJhIjoiY2t1MGphMm4wMHV4eDJvczhzMmp3Z2dwNyJ9.lXjaIHaVdGyfuKN_aXZI_g";
      // Create a new map.
      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [106.660172, 10.762622],
        zoom: 10,
      });
      var tinh;
      var huyen;
      var xa;
      fetch("vietnam_tinh.geojson")
        .then((response) => response.json())
        .then((text) => (tinh = text));
      fetch("vietnam_huyen.geojson")
        .then((response) => response.json())
        .then((text1) => (huyen = text1));
      fetch("vietnam.geojson")
        .then((response) => response.json())
        .then((text1) => (xa = text1));
      map.on("load", () => {
        // Add a source for the state polygons.
        map.addSource("states", {
          type: "geojson",
          data: tinh,
        });

        //Add a layer showing the state polygons.
        map.addLayer({
          id: "states-layer",
          type: "fill",
          source: "states",
          paint: {
            "fill-color": "rgba(200, 100, 240, 0.4)",
            "fill-outline-color": "red",
          },
        });
        map.addLayer({
          id: "states-layer-hover1",
          type: "fill",
          source: "states",
          paint: {
            "fill-color": "rgba(200, 100, 240, 0.6)",
          },
          filter: ["==", "NAME_1", ""],
        });
        map.addLayer({
          id: "states-layer-hover",
          type: "line",
          source: "states",
          paint: {
            "line-color": "white",
            "line-width": 2,
          },
          filter: ["==", "NAME_1", ""],
        });
        var click = 0;
        // When a click event occurs on a feature in the states layer,
        // open a popup at the location of the click, with description
        // HTML from the click event's properties.
        var popup;
        map.on("mousemove", "states-layer", (e) => {
          if (popup != null) popup.remove();
          if (click == 0) {
            popup = new mapboxgl.Popup({
              closeButton: false,
              closeOnClick: false,
            })
              .setLngLat(e.lngLat)
              .setHTML(e.features[0].properties.NAME_1)
              .addTo(map);
            map.setFilter("states-layer-hover", [
              "==",
              "NAME_1",
              e.features[0].properties.NAME_1,
            ]);
            map.setFilter("states-layer-hover1", [
              "==",
              "NAME_1",
              e.features[0].properties.NAME_1,
            ]);
          }
          if (click == 1) {
            popup = new mapboxgl.Popup({
              closeButton: false,
              closeOnClick: false,
            })
              .setLngLat(e.lngLat)
              .setHTML(e.features[0].properties.NAME_2)
              .addTo(map);
            map.setFilter("states-layer-hover", [
              "all",
              ["==", "NAME_1", e.features[0].properties.NAME_1],
              ["==", "NAME_2", e.features[0].properties.NAME_2],
            ]);
            map.setFilter("states-layer-hover1", [
              "all",
              ["==", "NAME_1", e.features[0].properties.NAME_1],
              ["==", "NAME_2", e.features[0].properties.NAME_2],
            ]);
          }
          if (click == 2) {
            popup = new mapboxgl.Popup({
              closeButton: false,
              closeOnClick: false,
            })
              .setLngLat(e.lngLat)
              .setHTML(e.features[0].properties.NAME_3)
              .addTo(map);
            map.setFilter("states-layer-hover", [
              "all",
              ["==", "NAME_2", e.features[0].properties.NAME_2],
              ["==", "NAME_3", e.features[0].properties.NAME_3],
            ]);
            map.setFilter("states-layer-hover1", [
              "all",
              ["==", "NAME_2", e.features[0].properties.NAME_2],
              ["==", "NAME_3", e.features[0].properties.NAME_3],
            ]);
          }
        });
        map.on("click", "states-layer", (e) => {
          if (click == 0) {
            map.getSource("states").setData(huyen);
            map.setFilter("states-layer", [
              "==",
              "NAME_1",
              e.features[0].properties.NAME_1,
            ]);
            map.flyTo({
            center: e.lngLat,
            zoom:8.9,
          });

          }
          if (click == 1) {
            map.getSource("states").setData(xa);
            map.setFilter("states-layer", [
              "all",
              ["==", "NAME_1", e.features[0].properties.NAME_1],
              ["==", "NAME_2", e.features[0].properties.NAME_2],
            ]);
            map.flyTo({
            center: e.lngLat,
            zoom:10,
          });
          }
          if (click==2){
            map.flyTo({
            center: e.lngLat,
            zoom:11.9,
          });
          }
          if (click < 2) click = click + 1;
          
          
        });
        // Change the cursor to a pointer when
        // the mouse is over the states layer.
        map.on("mouseenter", "states-layer", () => {
          map.getCanvas().style.cursor = "pointer";
        });

        // Change the cursor back to a pointer
        // when it leaves the states layer.
        map.on("mouseleave", "states-layer", () => {
          map.getCanvas().style.cursor = "";
          if (popup != null) popup.remove();
          if (click == 0) {
            map.setFilter("states-layer-hover", ["==", "NAME_1", ""]);
            map.setFilter("states-layer-hover1", ["==", "NAME_1", ""]);
          }
          if (click == 1) {
            map.setFilter("states-layer-hover", ["==", "NAME_2", ""]);
            map.setFilter("states-layer-hover1", ["==", "NAME_2", ""]);
          }
          if (click == 2) {
            map.setFilter("states-layer-hover", ["==", "NAME_3", ""]);
            map.setFilter("states-layer-hover1", ["==", "NAME_3", ""]);
          }
        });
      });
    </script>
  </body>
</html>
